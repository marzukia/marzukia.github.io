<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <title>Andryo Marzuki</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="A comprehensive tutorial on using Redux, Thunk, Immer, Redux Persist with React to have more robust state management." />

    <meta property="og:title" content="React State Management with Redux (and More)" />
    <meta property="og:description" content="A comprehensive tutorial on using Redux, Thunk, Immer, Redux Persist with React to have more robust state management." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://marzukia.github.io/post/react-state-management-with-redux-and-more/" />
    <meta itemprop="name" content="React State Management with Redux (and More)">
    <meta itemprop="description" content="A comprehensive tutorial on using Redux, Thunk, Immer, Redux Persist with React to have more robust state management.">
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="React State Management with Redux (and More)"/>
    <meta name="twitter:description" content="A comprehensive tutorial on using Redux, Thunk, Immer, Redux Persist with React to have more robust state management."/>

    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">

    
    <link rel="stylesheet" href="https://marzukia.github.io/scss/style.min.b1e205ce8a030e0f01243c443c4dfc72fa0485bfe9d03977fec089db444d634a.css" >

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170171726-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-170171726-1');
    </script>
</head>
<body><header>
    <a href='https://marzukia.github.io/'><h1 class="site-title">Andryo Marzuki</h1></a>
    <center>




<a
  href="https://instagram.com/andryo"
  target="_blank"
  class="social-link"
  title="Instagram link"
  rel="noopener"
  aria-label="follow on Instagram——Opens in a new window"
>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M14.667 12c0 1.473-1.194 2.667-2.667 2.667-1.473 0-2.667-1.193-2.667-2.667 0-1.473 1.194-2.667 2.667-2.667 1.473 0 2.667 1.194 2.667 2.667zm3.846-3.232c.038.843.046 1.096.046 3.232s-.008 2.389-.046 3.233c-.1 2.15-1.109 3.181-3.279 3.279-.844.038-1.097.047-3.234.047-2.136 0-2.39-.008-3.232-.046-2.174-.099-3.181-1.132-3.279-3.279-.039-.845-.048-1.098-.048-3.234s.009-2.389.047-3.232c.099-2.152 1.109-3.181 3.279-3.279.844-.039 1.097-.047 3.233-.047s2.39.008 3.233.046c2.168.099 3.18 1.128 3.28 3.28zm-2.405 3.232c0-2.269-1.84-4.108-4.108-4.108-2.269 0-4.108 1.839-4.108 4.108 0 2.269 1.84 4.108 4.108 4.108 2.269 0 4.108-1.839 4.108-4.108zm1.122-4.27c0-.53-.43-.96-.96-.96s-.96.43-.96.96.43.96.96.96c.531 0 .96-.43.96-.96zm6.77-7.73v24h-24v-24h24zm-4 12c0-2.172-.009-2.445-.048-3.298-.131-2.902-1.745-4.52-4.653-4.653-.854-.04-1.126-.049-3.299-.049s-2.444.009-3.298.048c-2.906.133-4.52 1.745-4.654 4.653-.039.854-.048 1.127-.048 3.299 0 2.173.009 2.445.048 3.298.134 2.906 1.746 4.521 4.654 4.654.854.039 1.125.048 3.298.048s2.445-.009 3.299-.048c2.902-.133 4.522-1.745 4.653-4.654.039-.853.048-1.125.048-3.298z"/></svg>
</a>



<a
  href="https://linkedin.com/in/andryomarzuki"
  target="_blank"
  class="social-link"
  title="LinkedIn link"
  rel="noopener"
  aria-label="follow on LinkedIn——Opens in a new window"
>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M0 0v24h24v-24h-24zm8 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.397-2.586 7-2.777 7 2.476v6.759z"/></svg>
</a>


<a
  href="https://github.com/marzukia"
  target="_blank"
  class="social-link"
  title="Github link"
  rel="noopener"
  aria-label="follow on Github——Opens in a new window"
>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M0 0v24h24v-24h-24zm14.534 19.59c-.406.078-.534-.171-.534-.384v-2.195c0-.747-.262-1.233-.55-1.481 1.782-.198 3.654-.875 3.654-3.947 0-.874-.311-1.588-.824-2.147.083-.202.357-1.016-.079-2.117 0 0-.671-.215-2.198.82-.639-.18-1.323-.267-2.003-.271-.68.003-1.364.091-2.003.269-1.528-1.035-2.2-.82-2.2-.82-.434 1.102-.16 1.915-.077 2.118-.512.56-.824 1.273-.824 2.147 0 3.064 1.867 3.751 3.645 3.954-.229.2-.436.552-.508 1.07-.457.204-1.614.557-2.328-.666 0 0-.423-.768-1.227-.825 0 0-.78-.01-.055.487 0 0 .525.246.889 1.17 0 0 .463 1.428 2.688.944v1.489c0 .211-.129.459-.528.385-3.18-1.057-5.472-4.056-5.472-7.59 0-4.419 3.582-8 8-8s8 3.581 8 8c0 3.533-2.289 6.531-5.466 7.59z"/></svg>
</a>




</center>
</header>
<div class="post">
    <h1>React State Management with Redux (and More)</h1>
    <div class="post-content">
        <p><code>ReactJS</code> is an awesome library to use for frontends. It&rsquo;s super fast to use when you want to get a really interactive and intuitive application up and running.</p>
<p><code>ReactJS</code> comes prepackaged with its own way to manage state locally within a component. When the value within a state needs to be shared with other components, it is passed down through usage of <code>props</code>. The stored value can be mutated within lower level components with usage using callback functions. In essence, using <code>ReactJS</code> prepackaged state system allows you to asynchronously write and read values from various components at different depths of the application.</p>
<p>As the complexity of your application grows, managing your application&rsquo;s state in this way can end up becoming cumbersome, this is where a library such as <code>redux-react</code> comes in. <code>redux-react</code> allows you to have a centralized area where your data is stored, this makes accessing your state much &lsquo;cleaner&rsquo;.</p>
<p>I then like to pair <code>redux-react</code> with <code>redux-thunk</code>, <code>immer</code> and <code>redux-persist</code>.</p>
<ul>
<li><code>redux-thunk</code> is middleware which will greatly expand the capability of the <code>redux-react</code> state by allowing the use of asynchronous logic and actions.</li>
<li><code>immer</code> will allow us to take advantage of immutability, in particular we&rsquo;ll make our <code>redux-react</code> state immutable.</li>
<li><code>redux-persist</code> will allow us to persist in our state.</li>
</ul>
<p><strong>Note</strong>: This article&rsquo;s code samples are in <code>TypeScript</code>. If you use <code>JavaScript</code>, you&rsquo;ll need to adjust it accordingly.</p>
<h2 id="redux">Redux</h2>
<p>The clear downside of using <code>redux-react</code> is the corresponding code overhead which is attached to implement it, you&rsquo;ll need to have the following elements in your store (or sub-stores):</p>
<ol>
<li>Types</li>
<li>State</li>
<li>Reducer</li>
<li>Actions</li>
<li>Selector</li>
</ol>
<p>In general, you&rsquo;ll have multiple &lsquo;sub-stores&rsquo; mapped into one state. As your application reaches a certain size, it becomes almost a necessity to split out your stores to avoid cluttered code.</p>
<p>Luckily, this is easily achievable by using <code>combineReducers()</code> to combine our reducers and a <code>RootState</code> to map out our relevant states.</p>
<h3 id="folder-structure">Folder Structure</h3>
<p>I normally create a <code>store</code> folder in my application root to contain all its various sub-stores.</p>
<pre><code>store/
    users/
        index.ts
        actions.ts
        selectors.ts
        reducers.ts
        state.ts
        types.ts
    types.ts
    state.ts
    index.ts
</code></pre><h3 id="types">Types</h3>
<p>For our store&rsquo;s types, we will need to define a basic type and a corresponding action. In general, my actions are categorized into three segments:</p>
<ol>
<li>Request</li>
<li>Response</li>
<li>Failure</li>
</ol>
<p>With this in mind, we start by defining our types as such:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/users/types.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">AUTHENTICATE_REQUEST</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#39;AUTHENTICATE_REQUEST&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">AUTHENTICATE_RESPONSE</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#39;AUTHENTICATE_RESPONSE&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">AUTHENTICATE_FAILED</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#39;AUTHENTICATE_FAILED&#39;</span><span style="color:#111">;</span>
</code></pre></div><p>Next, we need to define the corresponding action types which will specify which type to use, and what payload should be expected.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/users/types.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">interface</span> <span style="color:#75af00">AuthenticateRequestAction</span> <span style="color:#111">{</span>
    <span style="color:#75af00">type</span>: <span style="color:#00a8c8">typeof</span> <span style="color:#75af00">AUTHENTICATE_REQUEST</span><span style="color:#111">;</span>
    <span style="color:#75af00">payload</span><span style="color:#f92672">:</span> <span style="color:#111">{</span>
        <span style="color:#75af00">username</span>: <span style="color:#00a8c8">string</span><span style="color:#111">;</span>
        <span style="color:#75af00">password</span>: <span style="color:#00a8c8">string</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
<span style="color:#111">};</span>

<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">interface</span> <span style="color:#75af00">AuthenticateResponseAction</span> <span style="color:#111">{</span>
    <span style="color:#75af00">type</span>: <span style="color:#00a8c8">typeof</span> <span style="color:#75af00">AUTHENTICATE_RESPONSE</span><span style="color:#111">;</span>
    <span style="color:#75af00">payload</span><span style="color:#f92672">:</span> <span style="color:#111">{</span>
        <span style="color:#75af00">user</span>: <span style="color:#00a8c8">User</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
<span style="color:#111">};</span>

<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">interface</span> <span style="color:#75af00">AuthenticateFailedAction</span> <span style="color:#111">{</span>
    <span style="color:#75af00">type</span>: <span style="color:#00a8c8">typeof</span> <span style="color:#75af00">AUTHENTICATE_FAILED</span><span style="color:#111">;</span>
    <span style="color:#75af00">payload</span><span style="color:#f92672">:</span> <span style="color:#111">{</span>
        <span style="color:#75af00">error</span>: <span style="color:#00a8c8">Error</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
<span style="color:#111">};</span>
</code></pre></div><p>Lastly, you&rsquo;ll need to export your store&rsquo;s action types by doing something like below:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/users/types.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">export</span> <span style="color:#75af00">type</span> <span style="color:#75af00">UserAction</span> <span style="color:#f92672">=</span> <span style="color:#75af00">AuthenticateRequestAction</span> <span style="color:#f92672">|</span> <span style="color:#75af00">AuthenticateResponseAction</span> <span style="color:#f92672">|</span> <span style="color:#75af00">AuthenticateFailedAction</span><span style="color:#111">;</span>
</code></pre></div><h3 id="state">State</h3>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/users/state.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">interface</span> <span style="color:#75af00">UserState</span> <span style="color:#111">{</span>
    <span style="color:#75af00">data</span>: <span style="color:#00a8c8">User</span><span style="color:#111">;</span>
    <span style="color:#75af00">loading</span>: <span style="color:#00a8c8">boolean</span><span style="color:#111">;</span>
    <span style="color:#75af00">error?</span>: <span style="color:#00a8c8">Error</span><span style="color:#111">;</span>    
<span style="color:#111">};</span>
</code></pre></div><p>Our <code>UserState</code> will be encompassed by our <code>RootState</code> which is discussed further down this article.</p>
<p>The above interface is very simple:</p>
<ol>
<li>I have a <code>data</code> object which will capture the API response.</li>
<li>I have a <code>loading</code> boolean which I will use to implement load checks to prevent double queries.</li>
<li>I have an optional <code>error</code> which will only have a value if an <code>Error</code> is returned.</li>
</ol>
<h3 id="reducer">Reducer</h3>
<p>Our reducer is where the action (no pun intended) happens. You can think of the reducer as a switchboard operator who is directing callers to their intended target. Once the target is known, the state can be changed.</p>
<p>It&rsquo;s really important to note that we are working with immutable states here, when I say &lsquo;change&rsquo; I refer to replacing the state in its entirety with the relevant values adjusted.</p>
<p>The flow of action would be something as follows:</p>
<ol>
<li>The application dispatches a public action.</li>
<li>The application invokes the relevant functions, these functions will have a type assigned to it (covered next section).</li>
<li>The reducer receives the current state, and the action being invoked (which contains the type).</li>
<li>A state reducer is then called which will create a copy of the state and change the relevant values based on a switch.</li>
<li>A new state is returned from the reducer which has been adjusted based on the action.</li>
</ol>
<p>Below is a working example of how we would define our reducer and state reducer.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/users/reducers.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">import</span> <span style="color:#75af00">produce</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;immer&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">Reducer</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;redux&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">import</span> <span style="color:#111">{</span>
    <span style="color:#75af00">AUTHENTICATE_REQUEST</span><span style="color:#111">,</span>
    <span style="color:#75af00">AUTHENTICATE_RESPONSE</span><span style="color:#111">,</span>
    <span style="color:#75af00">AUTHENTICATE_FAILED</span><span style="color:#111">,</span>
<span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;./types&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">UserState</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;./state&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">UserAction</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;./types&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">initialState</span>: <span style="color:#00a8c8">UserState</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span>
    <span style="color:#75af00">data</span><span style="color:#f92672">:</span> <span style="color:#111">{</span>
        <span style="color:#75af00">id</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">9999</span><span style="color:#111">,</span>
        <span style="color:#75af00">username</span><span style="color:#f92672">:</span> <span style="color:#d88200">&#39;&#39;</span>
    <span style="color:#111">},</span>
    <span style="color:#75af00">loading</span>: <span style="color:#00a8c8">false</span><span style="color:#111">,</span>
    <span style="color:#75af00">error</span>: <span style="color:#00a8c8">undefined</span><span style="color:#111">,</span>
<span style="color:#111">};</span>

<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">userReducer</span>: <span style="color:#00a8c8">Reducer</span><span style="color:#f92672">&lt;</span><span style="color:#75af00">UserState</span><span style="color:#111">,</span> <span style="color:#75af00">UserAction</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#75af00">state</span><span style="color:#111">,</span> <span style="color:#75af00">action</span><span style="color:#111">)</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">let</span> <span style="color:#75af00">userState</span>: <span style="color:#00a8c8">UserState</span> <span style="color:#f92672">=</span> <span style="color:#75af00">state</span> <span style="color:#f92672">||</span> <span style="color:#75af00">initialState</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">{</span>
        <span style="color:#111">...</span><span style="color:#75af00">userState</span><span style="color:#111">,</span>
        <span style="color:#111">...</span><span style="color:#75af00">userStateReducer</span><span style="color:#111">(</span><span style="color:#75af00">state</span><span style="color:#111">,</span> <span style="color:#75af00">action</span><span style="color:#111">)</span>
    <span style="color:#111">};</span>
<span style="color:#111">};</span>

<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">userStateReducer</span> <span style="color:#f92672">=</span> <span style="color:#75af00">produce</span><span style="color:#111">((</span>
    <span style="color:#75af00">draftState</span>: <span style="color:#00a8c8">UserState</span><span style="color:#111">,</span>
    <span style="color:#75af00">action</span>: <span style="color:#00a8c8">UserAction</span>
    <span style="color:#111">)</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">switch</span> <span style="color:#111">(</span><span style="color:#75af00">action</span><span style="color:#111">.</span><span style="color:#75af00">type</span><span style="color:#111">)</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">case</span> <span style="color:#75af00">AUTHENTICATE_REQUEST</span>:
                <span style="color:#00a8c8">draftState.loading</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">true</span><span style="color:#111">;</span>
                <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
            <span style="color:#00a8c8">case</span> <span style="color:#75af00">AUTHENTICATE_RESPONSE</span>:
                <span style="color:#00a8c8">draftState.loading</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">false</span><span style="color:#111">;</span>
                <span style="color:#75af00">draftState</span><span style="color:#111">.</span><span style="color:#75af00">data</span> <span style="color:#f92672">=</span> <span style="color:#75af00">action</span><span style="color:#111">.</span><span style="color:#75af00">payload</span><span style="color:#111">.</span><span style="color:#75af00">user</span><span style="color:#111">;</span>
                <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
            <span style="color:#00a8c8">case</span> <span style="color:#75af00">AUTHENTICATE_FAILED</span>:
                <span style="color:#00a8c8">draftState.loading</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">false</span><span style="color:#111">;</span>
                <span style="color:#75af00">draftState</span><span style="color:#111">.</span><span style="color:#75af00">error</span> <span style="color:#f92672">=</span> <span style="color:#75af00">action</span><span style="color:#111">.</span><span style="color:#75af00">payload</span><span style="color:#111">.</span><span style="color:#75af00">error</span><span style="color:#111">;</span>
                <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
            <span style="color:#00a8c8">default</span><span style="color:#f92672">:</span>
                <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
    <span style="color:#111">};</span>
<span style="color:#111">});</span>
</code></pre></div><h3 id="actions">Actions</h3>
<p>In the previous section we talk about dispatching a public action from our application to trigger our reducer.</p>
<p>Since we&rsquo;re using <code>Thunk</code>, we need to define the appropriate types for our public actions.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/types.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">ThunkAction</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;redux-thunk&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">interface</span> <span style="color:#75af00">Action</span> <span style="color:#111">{</span>
    <span style="color:#75af00">type</span>: <span style="color:#00a8c8">string</span><span style="color:#111">;</span>
<span style="color:#111">};</span>

<span style="color:#00a8c8">export</span> <span style="color:#75af00">type</span> <span style="color:#75af00">AppThunk</span><span style="color:#f92672">&lt;</span><span style="color:#75af00">A</span> <span style="color:#00a8c8">extends</span> <span style="color:#75af00">Action</span> <span style="color:#f92672">=</span> <span style="color:#75af00">Action</span><span style="color:#111">,</span> <span style="color:#75af00">E</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">null</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> <span style="color:#75af00">ThunkAction</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">void</span><span style="color:#111">,</span> <span style="color:#75af00">RootState</span><span style="color:#111">,</span> <span style="color:#75af00">E</span><span style="color:#111">,</span> <span style="color:#75af00">A</span><span style="color:#f92672">&gt;</span><span style="color:#111">;</span>
</code></pre></div><p>Once the above is created, our actions can be really simply defined. Below is a working example of how this is done:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/users/actions.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">import</span> <span style="color:#111">{</span>
    <span style="color:#75af00">AUTHENTICATE_REQUEST</span><span style="color:#111">,</span>
    <span style="color:#75af00">AUTHENTICATE_RESPONSE</span><span style="color:#111">,</span>
    <span style="color:#75af00">AUTHENTICATE_FAILED</span><span style="color:#111">,</span>
    <span style="color:#75af00">AuthenticateRequestAction</span><span style="color:#111">,</span>
    <span style="color:#75af00">AuthenticateResponseAction</span><span style="color:#111">,</span>
    <span style="color:#75af00">AuthenticateFailedAction</span><span style="color:#111">,</span>
<span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;./types&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">User</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;../../types&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">AppThunk</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;../types&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">api</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;../../api&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">const</span> <span style="color:#75af00">authenticateRequest</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#75af00">username</span>: <span style="color:#00a8c8">string</span><span style="color:#111">,</span> <span style="color:#75af00">password</span>: <span style="color:#00a8c8">string</span><span style="color:#111">)</span><span style="color:#f92672">:</span> <span style="color:#75af00">AuthenticateRequestAction</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">{</span>
        <span style="color:#75af00">type</span>: <span style="color:#00a8c8">AUTHENTICATE_REQUEST</span><span style="color:#111">,</span>
        <span style="color:#75af00">payload</span><span style="color:#f92672">:</span> <span style="color:#111">{</span>
            <span style="color:#75af00">username</span><span style="color:#111">,</span>
            <span style="color:#75af00">password</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}</span>
<span style="color:#111">};</span>

<span style="color:#00a8c8">const</span> <span style="color:#75af00">authenticateResponse</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#75af00">user</span>: <span style="color:#00a8c8">User</span><span style="color:#111">)</span><span style="color:#f92672">:</span> <span style="color:#75af00">AuthenticateResponseAction</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">{</span>
        <span style="color:#75af00">type</span>: <span style="color:#00a8c8">AUTHENTICATE_RESPONSE</span><span style="color:#111">,</span>
        <span style="color:#75af00">payload</span><span style="color:#f92672">:</span> <span style="color:#111">{</span>
            <span style="color:#75af00">user</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}</span>
<span style="color:#111">};</span>

<span style="color:#00a8c8">const</span> <span style="color:#75af00">authenticateFailed</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#75af00">error</span>: <span style="color:#00a8c8">Error</span><span style="color:#111">)</span><span style="color:#f92672">:</span> <span style="color:#75af00">AuthenticateFailedAction</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">{</span>
        <span style="color:#75af00">type</span>: <span style="color:#00a8c8">AUTHENTICATE_FAILED</span><span style="color:#111">,</span>
        <span style="color:#75af00">payload</span><span style="color:#f92672">:</span> <span style="color:#111">{</span>
            <span style="color:#75af00">error</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}</span>
<span style="color:#111">};</span>

<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">authenticate</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#75af00">username</span>: <span style="color:#00a8c8">string</span><span style="color:#111">,</span> <span style="color:#75af00">password</span>: <span style="color:#00a8c8">string</span><span style="color:#111">)</span><span style="color:#f92672">:</span> <span style="color:#75af00">AppThunk</span> <span style="color:#f92672">=&gt;</span> <span style="color:#75af00">async</span> <span style="color:#75af00">dispatch</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
    <span style="color:#75af00">dispatch</span><span style="color:#111">(</span><span style="color:#75af00">authenticateRequest</span><span style="color:#111">(</span><span style="color:#75af00">username</span><span style="color:#111">,</span> <span style="color:#75af00">password</span><span style="color:#111">));</span>
    <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">let</span> <span style="color:#75af00">result</span> <span style="color:#f92672">=</span> <span style="color:#75af00">await</span> <span style="color:#75af00">api</span><span style="color:#111">.</span><span style="color:#75af00">authenticate</span><span style="color:#111">(</span><span style="color:#75af00">username</span><span style="color:#111">,</span> <span style="color:#75af00">password</span><span style="color:#111">);</span>
        <span style="color:#75af00">dispatch</span><span style="color:#111">(</span><span style="color:#75af00">authenticateResponse</span><span style="color:#111">(</span><span style="color:#75af00">result</span><span style="color:#111">));</span>
    <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#75af00">error</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#75af00">dispatch</span><span style="color:#111">(</span><span style="color:#75af00">authenticateFailed</span><span style="color:#111">(</span><span style="color:#75af00">error</span><span style="color:#111">));</span>
    <span style="color:#111">}</span>
<span style="color:#111">};</span>
</code></pre></div><p>In above, we would dispatch <code>authenticate(username, password)</code> which would then dispatch the other functions containing the relevant type.</p>
<h3 id="selectors">Selectors</h3>
<p>Lastly, in order to access our values we need to define selectors which will point to somewhere in our state.</p>
<p>This will mean that the state value used in multiple parts of our application will be simultaneously updated when our state is changed.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/users/selectors.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">getUser</span> <span style="color:#f92672">=</span> <span style="color:#75af00">createSelector</span><span style="color:#111">(</span>
    <span style="color:#75af00">userState</span><span style="color:#111">,</span>
    <span style="color:#111">(</span><span style="color:#75af00">state</span>: <span style="color:#00a8c8">UserState</span><span style="color:#111">)</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">return</span> <span style="color:#75af00">state</span><span style="color:#111">.</span><span style="color:#75af00">data</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
<span style="color:#111">);</span>
</code></pre></div><h2 id="putting-it-all-together">Putting It All Together</h2>
<p>Now that we&rsquo;ve got our sub-store&rsquo;s individual components put together, we need to make it easy to access.</p>
<p>First we can group and export our actions, selectors and reducers as follows:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/users/index.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">import</span> <span style="color:#f92672">*</span> <span style="color:#00a8c8">as</span> <span style="color:#75af00">userActions</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;./actions&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">import</span> <span style="color:#f92672">*</span> <span style="color:#00a8c8">as</span> <span style="color:#75af00">userSelectors</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;./selectors&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">userReducer</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;./reducers&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">export</span> <span style="color:#111">{</span> <span style="color:#75af00">userActions</span><span style="color:#111">,</span> <span style="color:#75af00">userReducer</span><span style="color:#111">,</span> <span style="color:#75af00">userSelectors</span> <span style="color:#111">};</span>
</code></pre></div><p>Now, when we want to access our actions, reducers or selectors we can import <code>userActions</code>, etc.</p>
<p>We need to define a <code>RootState</code> which will include all our sub-states. This is defined simply as:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/state.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">interface</span> <span style="color:#75af00">RootState</span> <span style="color:#111">{</span>
    <span style="color:#75af00">user</span>: <span style="color:#00a8c8">UserState</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></div><p>Lastly, we need an <code>index.ts</code> which will create our store itself.</p>
<p>The below code sample shows how we can persist our state, aswell as apply our <code>Thunk</code> middleware.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// store/index.ts
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">import</span> <span style="color:#75af00">thunk</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;redux-thunk&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">createStore</span><span style="color:#111">,</span> <span style="color:#75af00">applyMiddleware</span><span style="color:#111">,</span> <span style="color:#75af00">combineReducers</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;redux&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">persistStore</span><span style="color:#111">,</span> <span style="color:#75af00">persistReducer</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;redux-persist&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">import</span> <span style="color:#75af00">storage</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;redux-persist/lib/storage&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">userReducer</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;./user&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">const</span> <span style="color:#75af00">reducer</span> <span style="color:#f92672">=</span> <span style="color:#75af00">combineReducers</span><span style="color:#111">({</span>
    <span style="color:#75af00">user</span>: <span style="color:#00a8c8">userReducer</span><span style="color:#111">,</span>
<span style="color:#111">});</span>

<span style="color:#00a8c8">const</span> <span style="color:#75af00">persistConfig</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span> <span style="color:#75af00">key</span><span style="color:#f92672">:</span> <span style="color:#d88200">&#39;root&#39;</span><span style="color:#111">,</span> <span style="color:#75af00">storage</span><span style="color:#111">,</span> <span style="color:#111">};</span>
<span style="color:#00a8c8">const</span> <span style="color:#75af00">persistedReducer</span> <span style="color:#f92672">=</span> <span style="color:#75af00">persistReducer</span><span style="color:#111">(</span><span style="color:#75af00">persistConfig</span><span style="color:#111">,</span> <span style="color:#75af00">reducer</span><span style="color:#111">);</span>
<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">store</span> <span style="color:#f92672">=</span> <span style="color:#75af00">createStore</span><span style="color:#111">(</span><span style="color:#75af00">persistedReducer</span><span style="color:#111">,</span> <span style="color:#75af00">applyMiddleware</span><span style="color:#111">(</span><span style="color:#75af00">thunk</span><span style="color:#111">));</span>
<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">persistor</span> <span style="color:#f92672">=</span> <span style="color:#75af00">persistStore</span><span style="color:#111">(</span><span style="color:#75af00">store</span><span style="color:#111">);</span>
</code></pre></div><p>The below is an example of how you can access the store&rsquo;s value using the selector and actions you set up above.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#00a8c8">import</span> <span style="color:#75af00">React</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;react&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">useSelector</span><span style="color:#111">,</span> <span style="color:#75af00">useDispatch</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;react-redux&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">userSelectors</span><span style="color:#111">,</span> <span style="color:#75af00">userActions</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;../store/user&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">import</span> <span style="color:#111">{</span> <span style="color:#75af00">RootState</span> <span style="color:#111">}</span> <span style="color:#75af00">from</span> <span style="color:#d88200">&#39;../store/types&#39;</span><span style="color:#111">;</span>

<span style="color:#00a8c8">const</span> <span style="color:#75af00">selector</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#75af00">state</span>: <span style="color:#00a8c8">RootState</span><span style="color:#111">)</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">{</span>
        <span style="color:#75af00">user</span>: <span style="color:#00a8c8">userSelectors.getUser</span><span style="color:#111">(</span><span style="color:#75af00">state</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>
<span style="color:#111">};</span>

<span style="color:#00a8c8">export</span> <span style="color:#00a8c8">const</span> <span style="color:#75af00">ExampleComponent</span> <span style="color:#f92672">=</span> <span style="color:#111">()</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">const</span> <span style="color:#75af00">dispatch</span> <span style="color:#f92672">=</span> <span style="color:#75af00">useDispatch</span><span style="color:#111">();</span>

    <span style="color:#00a8c8">const</span> <span style="color:#111">{</span> <span style="color:#75af00">user</span> <span style="color:#111">}</span> <span style="color:#f92672">=</span> <span style="color:#75af00">useSelector</span><span style="color:#111">((</span><span style="color:#75af00">state</span>: <span style="color:#00a8c8">RootState</span><span style="color:#111">)</span> <span style="color:#f92672">=&gt;</span> <span style="color:#75af00">selector</span><span style="color:#111">(</span><span style="color:#75af00">state</span><span style="color:#111">));</span>

    <span style="color:#75af00">useEffect</span><span style="color:#111">(()</span> <span style="color:#f92672">=&gt;</span> <span style="color:#111">{</span>
        <span style="color:#75af00">dispatch</span><span style="color:#111">(</span><span style="color:#75af00">userActions</span><span style="color:#111">.</span><span style="color:#75af00">fetchUser</span><span style="color:#111">());</span>
    <span style="color:#111">},</span> <span style="color:#111">[</span><span style="color:#75af00">dispatch</span><span style="color:#111">]);</span>

    <span style="color:#75af00">console</span><span style="color:#111">.</span><span style="color:#75af00">log</span><span style="color:#111">(</span><span style="color:#75af00">user</span><span style="color:#111">);</span>

    <span style="color:#00a8c8">return</span> <span style="color:#f92672">&lt;</span><span style="color:#75af00">div</span><span style="color:#f92672">&gt;</span><span style="color:#111">;</span>
<span style="color:#111">};</span>
</code></pre></div><h2 id="closing-thoughts">Closing Thoughts</h2>
<p>Once you&rsquo;ve set this all up, you&rsquo;ll have a very clear and explicit way of interacting with your state. In general, debugging issues related to the state is much easier while working with an immutable state.</p>
<p>Of course, the code overhead of implementing the above means that you&rsquo;ll need to balance it based on the complexity of your application.</p>
<p>If you have a really simple CRUD API and all you need to do is represent that data, you may not need a fully fledged state system.</p>
<p>If you&rsquo;re new to working with <code>ReactJS</code> the above may be rather overwhelming, however the logic and purpose of using something like <code>Redux</code> becomes intuitive as your application increases in size and complexity.</p>

    </div>
</div>
<footer>
    © 2020, Andryo Marzuki
</footer>
</body>
</html>
